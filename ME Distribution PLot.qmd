---
title: "Margin of Error Distribution"
format: html
editor: visual
---

## Monte Carlo Simulation and 3-D Histogram

This is a plot of the distribution of the margin of error when both sample size and sample standard deviation changes. Both values are simulated using uniform distribution. We use 10,000 Monte Carlo simulations.

```{r, echo = FALSE, warning=FALSE, message=FALSE}
library(ggplot2)
library(plotly)

# Margin of Error Function
me <- function(z = 1.96, s, n = 30){
  me <- z * s / sqrt(n)
  return(me)
}

# Necessary Values and Empty Vectors
iterations <- 10000
stDevs <- numeric(iterations)
sampleSizes <- numeric(iterations)
margins <- numeric(iterations)

for(i in 1:iterations){
  stDevs[i] <- runif(n = 1, min = 1, max = 200)
  sampleSizes[i] <- round(runif(n = 1, min = 30, max = 500))
  margins[i] <- me(s = stDevs[i], n = sampleSizes[i])
}

# Plots
df <- data.frame(stDevs = stDevs,
                 sampleSizes = sampleSizes,
                 margins = margins)

# Create Grid
stDev_seq <- seq(1, 200, length.out = 100)
sampleSize_seq <- seq(30, 500, length.out = 100)
grid <- expand.grid(stDevs = stDev_seq, sampleSizes = sampleSize_seq)
grid$margins <- me(s = grid$stDevs, n = grid$sampleSizes)

# Plot 3d Smooth Histogram

# Reshape for 3D surface plotting
z_matrix <- matrix(grid$margins, 
                   nrow = length(unique(grid$sampleSizes)), 
                   ncol = length(unique(grid$stDevs)))

plot_ly(
  x = unique(grid$sampleSizes),
  y = unique(grid$stDevs),
  z = z_matrix
) %>%
  add_surface(colorscale = "Viridis") %>%
  layout(
    title = "3D Surface of Margin of Error",
    scene = list(
      xaxis = list(title = "Sample Size (n)"),
      yaxis = list(title = "Standard Deviation (Ïƒ)"),
      zaxis = list(title = "Margin of Error")
    )
  )

```
